# üõí E-Commerce API

A production-ready e-commerce REST API built with Golang and PostgreSQL. This project implements a modular architecture with type-safe database interactions using `sqlc`.

## üìÅ Project Structure

- **`cmd/`**: Contains application entry points (`main.go`) and server assembly logic (`api.go`).
- **`internal/products/`**: Business logic and HTTP handlers for product management.
- **`internal/orders/`**: Core logic for order placement, including transaction management.
- **`internal/adapters/postgresql/`**: Database migrations and repository code generated by `sqlc`.
- **`internal/json/` & `internal/env/`**: Shared utilities for JSON decoding/encoding and environment variable management.

## ‚ú® Features

- **Product Management**: List available products and retrieve details by ID.
- **Order Processing**: Atomic transaction-based order placement ensuring data consistency across `orders` and `order_items`.
- **Stock Validation**: Verifies product existence and stock levels before finalizing any purchase.
- **Security**: Strict JSON decoding to prevent malicious or unknown field submissions.
- **Database Safety**: Automated migrations with `goose` and type-safe queries with `sqlc`.

## üõ†Ô∏è Tech Stack

- **Language**: Go 1.25
- **Router**: Chi Router v5
- **Database**: PostgreSQL 16
- **DB Driver**: pgx/v5
- **Containerization**: Docker & Docker Compose

## üöÄ Getting Started

### üìã Prerequisites

- Docker and Docker Compose installed
- Go 1.25 or higher
- `sqlc` CLI tool installed ([installation guide](https://docs.sqlc.dev/en/latest/overview/install.html))
- `goose` CLI tool for migrations

### 1Ô∏è‚É£ Start the Database

Use Docker Compose to launch the PostgreSQL instance:

```bash
docker-compose up -d
```

This will start a PostgreSQL 16 container with the following default credentials:
- **Host**: localhost
- **Port**: 5432
- **User**: postgres
- **Password**: postgres
- **Database**: ecom

### 2Ô∏è‚É£ Generate Database Code with sqlc

After setting up your database schema and queries, generate type-safe Go code:

```bash
sqlc generate
```

This command reads the `sqlc.yaml` configuration and generates Go code in `internal/adapters/postgresql/` based on your SQL queries. The generated code provides:
- Type-safe database operations
- Automatic parameter binding
- Compile-time query validation

### 3Ô∏è‚É£ Run Database Migrations

Apply database migrations using goose:

```bash
goose -dir internal/adapters/postgresql/migrations postgres "host=localhost user=postgres password=postgres dbname=ecom port=5432 sslmode=disable" up
```

### 4Ô∏è‚É£ Environment Setup

The application looks for a `.env` file or environment variables for database connectivity.

Default DSN:

```
host=localhost user=postgres password=postgres dbname=ecom port=5432 sslmode=disable
```

### 5Ô∏è‚É£ Run the Server

```bash
go run cmd/*.go
```

The server will start on the configured port (default: 8080).

## üåê API Endpoints

- **GET /health**: System health check.
- **GET /products**: List all products in the catalog.
- **POST /orders**: Place a new order with multiple items.

### üì¶ Example Order Payload

```json
{
  "customerId": 1,
  "items": [
    {
      "productId": 101,
      "quantity": 2
    }
  ]
}
```
