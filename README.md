# ğŸ›’ E-Commerce API

A production-ready e-commerce REST API built with Golang and PostgreSQL. This project implements a modular architecture with type-safe database interactions using `sqlc`.

## ğŸ“ Project Structure

- **`cmd/`**: Contains application entry points (`main.go`) and server assembly logic (`api.go`).
- **`internal/products/`**: Business logic and HTTP handlers for product management.
- **`internal/orders/`**: Core logic for order placement, including transaction management.
- **`internal/adapters/postgresql/`**: Database migrations and repository code generated by `sqlc`.
- **`internal/json/` & `internal/env/`**: Shared utilities for JSON decoding/encoding and environment variable management.

## âœ¨ Features

- **Product Management**: List available products and retrieve details by ID.
- **Order Processing**: Atomic transaction-based order placement ensuring data consistency across `orders` and `order_items`.
- **Stock Validation**: Verifies product existence and stock levels before finalizing any purchase.
- **Security**: Strict JSON decoding to prevent malicious or unknown field submissions.
- **Database Safety**: Automated migrations with `goose` and type-safe queries with `sqlc`.

## ğŸ› ï¸ Tech Stack

  <p align="center">
    <img src="https://cdn.jsdelivr.net/gh/devicons/devicon/icons/go/go-original.svg" width="60" height="60" alt="Go" />
    &nbsp;&nbsp;&nbsp;
    <img src="https://cdn.jsdelivr.net/gh/devicons/devicon/icons/postgresql/postgresql-original.svg" width="60" height="60" alt="PostgreSQL" />
    &nbsp;&nbsp;&nbsp;
    <img src="https://cdn.jsdelivr.net/gh/devicons/devicon/icons/docker/docker-original.svg" width="60" height="60" alt="Docker" />
  </p>

- **Language**: <img src="https://cdn.jsdelivr.net/gh/devicons/devicon/icons/go/go-original.svg" width="20" height="20" /> Go 1.25
- **Router**: ğŸŒ Chi Router v5
- **Database**: <img src="https://cdn.jsdelivr.net/gh/devicons/devicon/icons/postgresql/postgresql-original.svg" width="20" height="20" /> PostgreSQL 16
- **DB Driver**: ğŸ”Œ pgx/v5
- **Code Generation**: âš™ï¸ sqlc
- **Migrations**: ğŸ¦† goose
- **Containerization**: <img src="https://cdn.jsdelivr.net/gh/devicons/devicon/icons/docker/docker-original.svg" width="20" height="20" /> Docker & Docker Compose

## ğŸš€ Getting Started

### ğŸ“‹ Prerequisites

- Docker and Docker Compose installed
- Go 1.25 or higher
- `sqlc` CLI tool installed ([installation guide](https://docs.sqlc.dev/en/latest/overview/install.html))
- `goose` CLI tool for migrations

### 1ï¸âƒ£ Start the Database

Use Docker Compose to launch the PostgreSQL instance:

```bash
docker-compose up -d
```

This will start a PostgreSQL 16 container with the following default credentials:
- **Host**: localhost
- **Port**: 5432
- **User**: postgres
- **Password**: postgres
- **Database**: ecom

### 2ï¸âƒ£ Generate Database Code with sqlc

After setting up your database schema and queries, generate type-safe Go code:

```bash
sqlc generate
```

This command reads the `sqlc.yaml` configuration and generates Go code in `internal/adapters/postgresql/` based on your SQL queries. The generated code provides:
- Type-safe database operations
- Automatic parameter binding
- Compile-time query validation

### 3ï¸âƒ£ Run Database Migrations

Apply database migrations using goose:

```bash
goose -dir internal/adapters/postgresql/migrations postgres "host=localhost user=postgres password=postgres dbname=ecom port=5432 sslmode=disable" up
```

### 4ï¸âƒ£ Environment Setup

The application looks for a `.env` file or environment variables for database connectivity.

Default DSN:

```
host=localhost user=postgres password=postgres dbname=ecom port=5432 sslmode=disable
```

### 5ï¸âƒ£ Run the Server

```bash
go run cmd/*.go
```

The server will start on the configured port (default: 8080).

## ğŸŒ API Endpoints

- **GET /health**: System health check.
- **GET /products**: List all products in the catalog.
- **POST /orders**: Place a new order with multiple items.

### ğŸ“¦ Example Order Payload

```json
{
  "customerId": 1,
  "items": [
    {
      "productId": 101,
      "quantity": 2
    }
  ]
}
```
